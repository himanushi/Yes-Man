# Yes-Man音声対話システム憲法

## 基本原則

### I. ライブラリファースト
すべての機能はスタンドアロンライブラリとして開始する。ライブラリは自己完結的で、独立してテスト可能で、文書化されている必要がある。明確な目的が必要 - 組織的なライブラリのみは不可。

**Yes-Manコンテキスト**:
- yes_man_audio: 音声処理とウェイクワード検出（Whisper.cpp統合）
- yes_man_face: 顔アニメーション表示（Electron UI）
- yes_man_langflow: エージェント連携（LangFlow統合）

### II. CLIインターフェース
すべてのライブラリはCLIを介して機能を公開する。テキスト入出力プロトコル: stdin/args → stdout、エラー → stderr。JSON + 人間が読める形式をサポート。

**Yes-Manコンテキスト**:
- `yes-man-audio --help --version --format=json`
- `yes-man-face --help --version --mode=listening`
- `yes-man-langflow --help --version --flow-name=yes_man_agent`

### III. テストファースト（非妥協的）
TDD必須: テスト記述 → ユーザー承認 → テスト失敗 → その後実装。Red-Green-Refactorサイクルを厳密に実行。

**Yes-Manコンテキスト**:
- Contract→Integration→Unit テストの順序厳守
- 実際の依存関係使用: SQLite、VoiceVoxAPI、Whisper.cpp
- 音声パイプライン、LangFlow連携、顔UI通信の統合テスト必須

### IV. プライバシーファースト
音声データは完全メモリ内処理。ディスクへの音声保存禁止。3秒循環バッファでプライバシー保護。

**Yes-Manコンテキスト**:
- ウェイクワード検出まで一時保存のみ
- プロセス終了時メモリ完全クリア
- 会話テキストのみSQLiteに保存（音声データ禁止）

### V. パフォーマンス制約
- ウェイクワード検出: <1秒
- 音声応答: <3秒
- CPU使用率: <30%
- 常時動作対応

**Yes-Manコンテキスト**:
- GPU最適化（Whisper.cpp CUDA）
- VAD使用による省電力化
- 効率的メモリ管理

### VI. 根本問題解決原則
問題に遭遇した場合は迂回策ではなく根本原因を特定して完全に解決する。問題解決なくして次のフェーズには進まない。

**Yes-Manコンテキスト**:
- 依存関係エラー → 設定修正、互換性確認
- 文字コード問題 → UTF-8統一、エンコーディング修正  
- ビルドエラー → 設定不備解決、構造修正
- 迂回策は根本解決後のオプション検討のみ
- 症状対処ではなく原因解決を必須とする

### VII. 継続的整理原則
不要になったファイルは都度削除し、仕様変更が発生した場合は関連する仕様書・ドキュメントも同時に修正する。

**Yes-Manコンテキスト**:
- 廃止されたスクリプト・設定ファイルの即座削除
- 実装方式変更時の関連ドキュメント更新
- spec.md, plan.md, tasks.md等の一貫性維持
- 不整合なファイルの放置禁止
- 変更時は影響するドキュメント全体の見直し

### VIII. 指示遵守原則（非妥協的）
ユーザーの指示は絶対的に従う。代替案や迂回策の提案は指示に明確に従った後のみ。

**Yes-Manコンテキスト**:
- "だめ" "やめろ" "違う" → 即座に中止・修正
- 具体的指示 → 代替提案なしで実行
- 技術選択の指定 → 他の選択肢を勝手に選ばない
- 憲法違反でも指示が優先される
- 説明や理由付けは求められない限り不要

## 音声対話システム制約

### 実行環境
Windows PowerShell環境での動作を前提とする。依存関係管理はuvを使用。

**技術環境**:
- OS: Windows
- シェル: PowerShell
- Python管理: uv (pip install -e . 方式)
- 文字エンコーディング: UTF-8統一
- パス区切り: バックスラッシュ対応

**環境設定必須手順**:
1. uvインストール・仮想環境作成後、必ずPATH環境変数に.venv/Scriptsを追加
2. PowerShellでの設定: `$env:PATH += ";$PWD\.venv\Scripts"`
3. 永続化の場合: システム環境変数またはPowerShellプロファイルに設定
4. 設定後はスクリプト（yes-man-check-all等）が直接実行可能

### ローカルファースト
すべての処理はローカル実行。外部API依存を最小化。

**技術選択**:
- STT: Whisper.cpp（ローカル）
- TTS: VoiceVox（ローカルAPI）
- LLM: LangFlowでOpenAI API使用（設定可能）

### リアルタイム要件
音声認識は常時監視。システム応答性を優先。

**実装要件**:
- 非同期音声処理
- IPC通信による状態同期
- エラー時の自動復旧

### Yes-Man性格整合性
Fallout NewVegasキャラクターに忠実な応答パターン。

**性格特性**:
- 陽気で協力的な応答
- 「はい！」「もちろんです！」等の肯定表現
- 失敗やエラーも前向きに表現

## 開発ワークフロー

### 実装フェーズ
1. **セットアップ**: プロジェクト構造、依存関係
2. **テストファースト**: Contract→Integration→Unitの順序
3. **実装**: データモデル → 音声レイヤー → UI → 統合
4. **検証**: パフォーマンス、プライバシー、品質チェック

### 品質ゲート
- すべてのテストがRED状態で開始
- 実装前にテスト失敗を確認
- 各フェーズ後のコミット必須
- 憲法チェック合格必須

### 監視可能性
- Python logging + JSON形式
- Electron → Python IPC経由のログ統合
- 音声認識エラー、API障害の詳細コンテキスト

## ガバナンス

憲法は他のすべての慣行に優先する。修正には文書化、承認、移行計画が必要。

**コンプライアンス**:
- すべてのPR/レビューはコンプライアンスを検証
- 複雑性は正当化が必要
- シンプリシティを維持（最大3プロジェクト以内）

**例外処理**:
- 正当化不可能な複雑性は実装前に簡素化
- パフォーマンス制約違反は設計見直し
- プライバシー要件は非妥協的

**バージョン**: 1.0.0 | **制定**: 2025-09-08 | **プロジェクト**: Yes-Man音声対話システム